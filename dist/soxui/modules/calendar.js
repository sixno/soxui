(function(){"use strict";function e(){this.version="1.0.0";this.modules=[];if(typeof soxui!="undefined"&&soxui.$){var t=soxui.$}else{if(typeof jQuery=="undefined"){typeof console=="object"&&console.error("soxpop error: sorry, jQuery is required, you must load it before this script.");return false}}var h={v:"5.0.9",config:{},index:0,set:function(e){var t=this;t.config=H.extend({},t.config,e);return t},ready:function(e){e();return this}},n=function(){var t=this;return{hint:function(e){t.hint.call(t,e)},config:t.config}},e="calendar",i=".soxui-calendar",C="soxui-this",a="soxui-show",r="soxui-hide",M="calendar-disabled",l="开始日期超出了结束日期<br>建议重新选择",y=[100,2e5],s="soxui-calendar-static",b="soxui-calendar-list",d="calendar-selected",o="soxui-calendar-hint",c="calendar-day-prev",m="calendar-day-next",u="soxui-calendar-footer",k=".calendar-btns-confirm",E="calendar-time-text",S=".calendar-btns-time",p=function(e){var t=this;t.index=++h.index;t.config=H.extend({},t.config,h.config,e);h.ready(function(){t.init()})},H=function(e){return new t(e)};H.extend=function(){var e=1,t=arguments,a=function(e,t){e=e||(t.constructor===Array?[]:{});for(var n in t){e[n]=t[n]&&t[n].constructor===Object?a(e[n],t[n]):t[n]}return e};t[0]=typeof t[0]==="object"?t[0]:{};for(;e<t.length;e++){if(typeof t[e]==="object"){a(t[0],t[e])}}return t[0]};H.ie=function(){var e=navigator.userAgent.toLowerCase();return!!window.ActiveXObject||"ActiveXObject"in window?(e.match(/msie\s(\d+)/)||[])[1]||"11":false}();H.stope=function(e){e=e||window.event;e.stopPropagation?e.stopPropagation():e.cancelBubble=true};H.each=function(e,t){var n,a=this;if(typeof t!=="function")return a;e=e||[];if(e.constructor===Object){for(n in e){if(t.call(e[n],n,e[n]))break}}else{for(n=0;n<e.length;n++){if(t.call(e[n],n,e[n]))break}}return a};H.digit=function(e,t,n){var a="";e=String(e);t=t||2;for(var i=e.length;i<t;i++){a+="0"}return e<Math.pow(10,t)?a+(e|0):e};H.elem=function(e,t){var n=document.createElement(e);H.each(t||{},function(e,t){n.setAttribute(e,t)});return n};p.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0};p.prototype.config={type:"date",range:false,format:"yyyy-MM-dd",value:null,isInitValue:true,min:"1900-1-1",max:"2099-12-31",trigger:"focus",show:false,showBottom:true,btns:["clear","now","confirm"],lang:"cn",theme:"default",position:null,calendar:false,mark:{},zIndex:null,done:null,change:null};p.prototype.lang=function(){var e=this,t=e.config,n={cn:{weeks:["日","一","二","三","四","五","六"],time:["时","分","秒"],timeTips:"选择时间",startTime:"开始时间",endTime:"结束时间",dateTips:"返回日期",month:["一","二","三","四","五","六","七","八","九","十","十一","十二"],tools:{confirm:"确定",clear:"清空",now:"现在"}},en:{weeks:["Su","Mo","Tu","We","Th","Fr","Sa"],time:["Hours","Minutes","Seconds"],timeTips:"Select Time",startTime:"Start Time",endTime:"End Time",dateTips:"Select Date",month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],tools:{confirm:"Confirm",clear:"Clear",now:"Now"}}};return n[t.lang]||n["cn"]};p.prototype.init=function(){var a=this,l=a.config,i="yyyy|y|MM|M|dd|d|HH|H|mm|m|ss|s",e=l.position==="static",t={year:"yyyy",month:"yyyy-MM",date:"yyyy-MM-dd",time:"HH:mm:ss",datetime:"yyyy-MM-dd HH:mm:ss"};l.elem=H(l.elem);l.eventElem=H(l.eventElem);if(!l.elem[0])return;if(l.range===true)l.range="-";if(l.format===t.date){l.format=t[l.type]}a.format=l.format.match(new RegExp(i+"|.","g"))||[];a.EXP_IF="";a.EXP_SPLIT="";H.each(a.format,function(e,t){var n=new RegExp(i).test(t)?"\\d{"+function(){if(new RegExp(i).test(a.format[e===0?e+1:e-1]||"")){if(/^yyyy|y$/.test(t))return 4;return t.length}if(/^yyyy$/.test(t))return"1,4";if(/^y$/.test(t))return"1,308";return"1,2"}()+"}":"\\"+t;a.EXP_IF=a.EXP_IF+n;a.EXP_SPLIT=a.EXP_SPLIT+"("+n+")"});a.EXP_IF=new RegExp("^"+(l.range?a.EXP_IF+"\\s\\"+l.range+"\\s"+a.EXP_IF:a.EXP_IF)+"$");a.EXP_SPLIT=new RegExp("^"+a.EXP_SPLIT+"$","");if(!a.isInput(l.elem[0])){if(l.trigger==="focus"){l.trigger="click"}}if(!l.elem.attr("lay-key")){l.elem.attr("lay-key",a.index);l.eventElem.attr("lay-key",a.index)}l.mark=H.extend({},l.calendar&&l.lang==="cn"?{"0-1-1":"元旦","0-2-14":"情人","0-3-8":"妇女","0-3-12":"植树","0-4-1":"愚人","0-5-1":"劳动","0-5-4":"青年","0-6-1":"儿童","0-9-10":"教师","0-9-18":"国耻","0-10-1":"国庆","0-12-25":"圣诞"}:{},l.mark);H.each(["min","max"],function(e,t){var n=[],a=[];if(typeof l[t]==="number"){var i=l[t],r=(new Date).getTime(),s=864e5,o=new Date(i?i<s?r+i*s:i:r);n=[o.getFullYear(),o.getMonth()+1,o.getDate()];i<s||(a=[o.getHours(),o.getMinutes(),o.getSeconds()])}else{n=(l[t].match(/\d+-\d+-\d+/)||[""])[0].split("-");a=(l[t].match(/\d+:\d+:\d+/)||[""])[0].split(":")}l[t]={year:n[0]|0||(new Date).getFullYear(),month:n[1]?(n[1]|0)-1:(new Date).getMonth(),date:n[2]|0||(new Date).getDate(),hours:a[0]|0,minutes:a[1]|0,seconds:a[2]|0}});a.elemID="soxui-calendar"+l.elem.attr("lay-key");if(l.show||e)a.render();e||a.events();if(l.value&&l.isInitValue){if(l.value.constructor===Date){a.setValue(a.parse(0,a.systemDate(l.value)))}else{a.setValue(l.value)}}};p.prototype.render=function(){var e=this,o=e.config,l=e.lang(),i=o.position==="static",n=e.elem=H.elem("div",{id:e.elemID,class:["soxui-calendar",o.range?" soxui-calendar-range":"",i?" "+s:"",o.theme&&o.theme!=="default"&&!/^#/.test(o.theme)?" calendar-theme-"+o.theme:""].join("")}),d=e.elemMain=[],c=e.elemHeader=[],m=e.elemCont=[],f=e.table=[],t=e.footer=H.elem("div",{class:u});if(o.zIndex)n.style.zIndex=o.zIndex;H.each(new Array(2),function(e){if(!o.range&&e>0){return true}var n=H.elem("div",{class:"soxui-calendar-header"}),t=[function(){var e=H.elem("i",{class:"soxui-icon calendar-icon calendar-prev-y"});e.innerHTML="&#xe65a;";return e}(),function(){var e=H.elem("i",{class:"soxui-icon calendar-icon calendar-prev-m"});e.innerHTML="&#xe603;";return e}(),function(){var e=H.elem("div",{class:"calendar-set-ym"}),t=H.elem("span"),n=H.elem("span");e.appendChild(t);e.appendChild(n);return e}(),function(){var e=H.elem("i",{class:"soxui-icon calendar-icon calendar-next-m"});e.innerHTML="&#xe602;";return e}(),function(){var e=H.elem("i",{class:"soxui-icon calendar-icon calendar-next-y"});e.innerHTML="&#xe65b;";return e}()],a=H.elem("div",{class:"soxui-calendar-content"}),i=H.elem("table"),r=H.elem("thead"),s=H.elem("tr");H.each(t,function(e,t){n.appendChild(t)});r.appendChild(s);H.each(new Array(6),function(n){var a=i.insertRow(0);H.each(new Array(7),function(e){if(n===0){var t=H.elem("th");t.innerHTML=l.weeks[e];s.appendChild(t)}a.insertCell(e)})});i.insertBefore(r,i.children[0]);a.appendChild(i);d[e]=H.elem("div",{class:"soxui-calendar-main calendar-main-list-"+e});d[e].appendChild(n);d[e].appendChild(a);c.push(t);m.push(a);f.push(i)});H(t).html(function(){var e=[],a=[];if(o.type==="datetime"){e.push('<span lay-type="datetime" class="calendar-btns-time">'+l.timeTips+"</span>")}H.each(o.btns,function(e,t){var n=l.tools[t]||"btn";if(o.range&&t==="now")return;if(i&&t==="clear")n=o.lang==="cn"?"重置":"Reset";a.push('<span lay-type="'+t+'" class="calendar-btns-'+t+'">'+n+"</span>")});e.push('<div class="calendar-footer-btns">'+a.join("")+"</div>");return e.join("")}());H.each(d,function(e,t){n.appendChild(t)});o.showBottom&&n.appendChild(t);if(/^#/.test(o.theme)){var a=H.elem("style"),r=["#{{id}} .soxui-calendar-header{background-color:{{theme}};}","#{{id}} .soxui-this{background-color:{{theme}} !important;}"].join("").replace(/{{id}}/g,e.elemID).replace(/{{theme}}/g,o.theme);if("styleSheet"in a){a.setAttribute("type","text/css");a.styleSheet.cssText=r}else{a.innerHTML=r}H(n).addClass("calendar-theme-molv");n.appendChild(a)}e.remove(p.thisElemDate);i?o.elem.append(n):(document.body.appendChild(n),e.position());e.checkDate().calendar();e.changeEvent();p.thisElemDate=e.elemID;typeof o.ready==="function"&&o.ready(H.extend({},o.dateTime,{month:o.dateTime.month+1}))};p.prototype.remove=function(e){var t=this,n=t.config,a=H("#"+(e||t.elemID));if(!a.hasClass(s)){t.checkDate(function(){a.remove()})}return t};p.prototype.position=function(){var e=this,t=e.config,n=e.bindElem||t.elem[0],a=n.getBoundingClientRect(),i=e.elem.offsetWidth,r=e.elem.offsetHeight,s=function(e){e=e?"scrollLeft":"scrollTop";return document.body[e]|document.documentElement[e]},o=function(e){return document.documentElement[e?"clientWidth":"clientHeight"]},l=5,d=a.left,c=a.bottom;if(d+i+l>o("width")){d=o("width")-i-l}if(c+r+l>o()){c=a.top>r?a.top-r:o()-r;c=c-l*2}if(t.position){e.elem.style.position=t.position}e.elem.style.left=d+(t.position==="fixed"?0:s(1))+"px";e.elem.style.top=c+(t.position==="fixed"?0:s())+"px"};p.prototype.hint=function(e){var t=this,n=t.config,a=H.elem("div",{class:o});if(!t.elem)return;a.innerHTML=e||"";H(t.elem).find("."+o).remove();t.elem.appendChild(a);clearTimeout(t.hinTimer);t.hinTimer=setTimeout(function(){H(t.elem).find("."+o).remove()},3e3)};p.prototype.getAsYM=function(e,t,n){n?t--:t++;if(t<0){t=11;e--}if(t>11){t=0;e++}return[e,t]};p.prototype.systemDate=function(e){var t=e||new Date;return{year:t.getFullYear(),month:t.getMonth(),date:t.getDate(),hours:e?e.getHours():0,minutes:e?e.getMinutes():0,seconds:e?e.getSeconds():0}};p.prototype.checkDate=function(e){var o=this,t=new Date,l=o.config,n=l.dateTime=l.dateTime||o.systemDate(),a,d,i=o.bindElem||l.elem[0],r=o.isInput(i)?"val":"html",s=o.isInput(i)?i.value:l.position==="static"?"":i.innerHTML,c=function(e){if(e.year>y[1])e.year=y[1],d=true;if(e.month>11)e.month=11,d=true;if(e.hours>23)e.hours=0,d=true;if(e.minutes>59)e.minutes=0,e.hours++,d=true;if(e.seconds>59)e.seconds=0,e.minutes++,d=true;a=h.getEndDate(e.month+1,e.year);if(e.date>a)e.date=a,d=true},m=function(a,i,r){var s=["startTime","endTime"];i=(i.match(o.EXP_SPLIT)||[]).slice(1);r=r||0;if(l.range){o[s[r]]=o[s[r]]||{}}H.each(o.format,function(e,t){var n=parseFloat(i[e]);if(i[e].length<t.length)d=true;if(/yyyy|y/.test(t)){if(n<y[0])n=y[0],d=true;a.year=n}else if(/MM|M/.test(t)){if(n<1)n=1,d=true;a.month=n-1}else if(/dd|d/.test(t)){if(n<1)n=1,d=true;a.date=n}else if(/HH|H/.test(t)){if(n<1)n=0,d=true;a.hours=n;l.range&&(o[s[r]].hours=n)}else if(/mm|m/.test(t)){if(n<1)n=0,d=true;a.minutes=n;l.range&&(o[s[r]].minutes=n)}else if(/ss|s/.test(t)){if(n<1)n=0,d=true;a.seconds=n;l.range&&(o[s[r]].seconds=n)}});c(a)};if(e==="limit")return c(n),o;s=s||l.value;if(typeof s==="string"){s=s.replace(/\s+/g," ").replace(/^\s|\s$/g,"")}if(o.startState&&!o.endState){delete o.startState;o.endState=true}if(typeof s==="string"&&s){if(o.EXP_IF.test(s)){if(l.range){s=s.split(" "+l.range+" ");o.startDate=o.startDate||o.systemDate();o.endDate=o.endDate||o.systemDate();l.dateTime=H.extend({},o.startDate);H.each([o.startDate,o.endDate],function(e,t){m(t,s[e],e)})}else{m(n,s)}}else{o.hint("日期格式不合法<br>必须遵循下述格式：<br>"+(l.range?l.format+" "+l.range+" "+l.format:l.format)+"<br>已为你重置");d=true}}else if(s&&s.constructor===Date){l.dateTime=o.systemDate(s)}else{l.dateTime=o.systemDate();delete o.startState;delete o.endState;delete o.startDate;delete o.endDate;delete o.startTime;delete o.endTime}c(n);if(d&&s){o.setValue(l.range?o.endDate?o.parse():"":o.parse())}e&&e();return o};p.prototype.mark=function(e,a){var t=this,i,n=t.config;H.each(n.mark,function(e,t){var n=e.split("-");if((n[0]==a[0]||n[0]==0)&&(n[1]==a[1]||n[1]==0)&&n[2]==a[2]){i=t||a[2]}});i&&e.html('<span class="calendar-day-mark">'+i+"</span>");return t};p.prototype.limit=function(e,t,n,i){var r=this,a=r.config,s={},o=a[n>41?"endDate":"dateTime"],l,d=H.extend({},o,t||{});H.each({now:d,min:a.min,max:a.max},function(e,a){s[e]=r.newDate(H.extend({year:a.year,month:a.month,date:a.date},function(){var n={};H.each(i,function(e,t){n[t]=a[t]});return n}())).getTime()});l=s.now<s.min||s.now>s.max;e&&e[l?"addClass":"removeClass"](M);return l};p.prototype.calendar=function(e){var i=this,r=i.config,s=e||r.dateTime,t=new Date,o,l,d,n=i.lang(),a=r.type!=="date"&&r.type!=="datetime",c=e?1:0,m=H(i.table[c]).find("td"),f=H(i.elemHeader[c][2]).find("span");if(s.year<y[0])s.year=y[0],i.hint("最低只能支持到公元"+y[0]+"年");if(s.year>y[1])s.year=y[1],i.hint("最高只能支持到公元"+y[1]+"年");if(!i.firstDate){i.firstDate=H.extend({},s)}t.setFullYear(s.year,s.month,1);o=t.getDay();l=h.getEndDate(s.month||12,s.year);d=h.getEndDate(s.month+1,s.year);H.each(m,function(e,t){var n=[s.year,s.month],a=0;t=H(t);t.removeAttr("class");if(e<o){a=l-o+e;t.addClass("calendar-day-prev");n=i.getAsYM(s.year,s.month,"sub")}else if(e>=o&&e<d+o){a=e-o;if(!r.range){a+1===s.date&&t.addClass(C)}}else{a=e-d-o;t.addClass("calendar-day-next");n=i.getAsYM(s.year,s.month)}n[1]++;n[2]=a+1;t.attr("lay-ymd",n.join("-")).html(n[2]);i.mark(t,n).limit(t,{year:n[0],month:n[1]-1,date:n[2]},e)});H(f[0]).attr("lay-ym",s.year+"-"+(s.month+1));H(f[1]).attr("lay-ym",s.year+"-"+(s.month+1));if(r.lang==="cn"){H(f[0]).attr("lay-type","year").html(s.year+"年");H(f[1]).attr("lay-type","month").html(s.month+1+"月")}else{H(f[0]).attr("lay-type","month").html(n.month[s.month]);H(f[1]).attr("lay-type","year").html(s.year)}if(a){if(r.range){e?i.endDate=i.endDate||{year:s.year+(r.type==="year"?1:0),month:s.month+(r.type==="month"?0:-1)}:i.startDate=i.startDate||{year:s.year,month:s.month};if(e){i.listYM=[[i.startDate.year,i.startDate.month+1],[i.endDate.year,i.endDate.month+1]];i.list(r.type,0).list(r.type,1);r.type==="time"?i.setBtnStatus("时间",H.extend({},i.systemDate(),i.startTime),H.extend({},i.systemDate(),i.endTime)):i.setBtnStatus(true)}}if(!r.range){i.listYM=[[s.year,s.month+1]];i.list(r.type,0)}}if(r.range&&!e){var u=i.getAsYM(s.year,s.month);i.calendar(H.extend({},s,{year:u[0],month:u[1]}))}if(!r.range)i.limit(H(i.footer).find(k),null,0,["hours","minutes","seconds"]);if(r.range&&e&&!a)i.stampRange();return i};p.prototype.list=function(n,a){var i=this,r=i.config,s=r.dateTime,o=i.lang(),l=r.range&&r.type!=="date"&&r.type!=="datetime",d=H.elem("ul",{class:b+" "+{year:"calendar-year-list",month:"calendar-month-list",time:"calendar-time-list"}[n]}),e=i.elemHeader[a],t=H(e[2]).find("span"),c=i.elemCont[a||0],m=H(c).find("."+b)[0],f=r.lang==="cn",u=f?"年":"",h=i.listYM[a]||{},y=["hours","minutes","seconds"],p=["startTime","endTime"][a];if(h[0]<1)h[0]=1;if(n==="year"){var g,v=g=h[0]-7;if(v<1)v=g=1;H.each(new Array(15),function(e){var t=H.elem("li",{"lay-ym":g}),n={year:g};g==h[0]&&H(t).addClass(C);t.innerHTML=g+u;d.appendChild(t);if(g<i.firstDate.year){n.month=r.min.month;n.date=r.min.date}else if(g>=i.firstDate.year){n.month=r.max.month;n.date=r.max.date}i.limit(H(t),n,a);g++});H(t[f?0:1]).attr("lay-ym",g-8+"-"+h[1]).html(v+u+" - "+(g-1+u))}else if(n==="month"){H.each(new Array(12),function(e){var t=H.elem("li",{"lay-ym":e}),n={year:h[0],month:e};e+1==h[1]&&H(t).addClass(C);t.innerHTML=o.month[e]+(f?"月":"");d.appendChild(t);if(h[0]<i.firstDate.year){n.date=r.min.date}else if(h[0]>=i.firstDate.year){n.date=r.max.date}i.limit(H(t),n,a)});H(t[f?0:1]).attr("lay-ym",h[0]+"-"+h[1]).html(h[0]+u)}else if(n==="time"){var D=function(){H(d).find("ol").each(function(n,e){H(e).find("li").each(function(e,t){i.limit(H(t),[{hours:e},{hours:i[p].hours,minutes:e},{hours:i[p].hours,minutes:i[p].minutes,seconds:e}][n],a,[["hours"],["hours","minutes"],["hours","minutes","seconds"]][n])})});if(!r.range)i.limit(H(i.footer).find(k),i[p],0,["hours","minutes","seconds"])};if(r.range){if(!i[p])i[p]={hours:0,minutes:0,seconds:0}}else{i[p]=s}H.each([24,60,60],function(t,e){var n=H.elem("li"),a=["<p>"+o.time[t]+"</p><ol>"];H.each(new Array(e),function(e){a.push("<li"+(i[p][y[t]]===e?' class="'+C+'"':"")+">"+H.digit(e,2)+"</li>")});n.innerHTML=a.join("")+"</ol>";d.appendChild(n)});D()}if(m)c.removeChild(m);c.appendChild(d);if(n==="year"||n==="month"){H(i.elemMain[a]).addClass("calendar-ym-show");H(d).find("li").on("click",function(){var e=H(this).attr("lay-ym")|0;if(H(this).hasClass(M))return;if(a===0){s[n]=e;if(l)i.startDate[n]=e;i.limit(H(i.footer).find(k),null,0)}else{if(l){i.endDate[n]=e}else{var t=n==="year"?i.getAsYM(e,h[1]-1,"sub"):i.getAsYM(h[0],e,"sub");H.extend(s,{year:t[0],month:t[1]})}}if(r.type==="year"||r.type==="month"){H(d).find("."+C).removeClass(C);H(this).addClass(C);if(r.type==="month"&&n==="year"){i.listYM[a][0]=e;l&&(i[["startDate","endDate"][a]].year=e);i.list("month",a)}}else{i.checkDate("limit").calendar();i.closeList()}i.setBtnStatus();r.range||i.done(null,"change");H(i.footer).find(S).removeClass(M)})}else{var x=H.elem("span",{class:E}),T=function(){H(d).find("ol").each(function(e){var n=this,t=H(n).find("li");n.scrollTop=30*(i[p][y[e]]-2);if(n.scrollTop<=0){t.each(function(e,t){if(!H(this).hasClass(M)){n.scrollTop=30*(e-2);return true}})}})},w=H(e[2]).find("."+E);T();x.innerHTML=r.range?[o.startTime,o.endTime][a]:o.timeTips;H(i.elemMain[a]).addClass("calendar-time-show");if(w[0])w.remove();e[2].appendChild(x);H(d).find("ol").each(function(t){var n=this;H(n).find("li").on("click",function(){var e=this.innerHTML|0;if(H(this).hasClass(M))return;if(r.range){i[p][y[t]]=e}else{s[y[t]]=e}H(n).find("."+C).removeClass(C);H(this).addClass(C);D();T();(i.endDate||r.type==="time")&&i.done(null,"change");i.setBtnStatus()})})}return i};p.prototype.listYM=[];p.prototype.closeList=function(){var n=this,e=n.config;H.each(n.elemCont,function(e,t){H(this).find("."+b).remove();H(n.elemMain[e]).removeClass("calendar-ym-show calendar-time-show")});H(n.elem).find("."+E).remove()};p.prototype.setBtnStatus=function(e,t,n){var a=this,i=a.config,r,s=H(a.footer).find(k),o=i.range&&i.type!=="date"&&i.type!=="time";if(o){t=t||a.startDate;n=n||a.endDate;r=a.newDate(t).getTime()>a.newDate(n).getTime();a.limit(null,t)||a.limit(null,n)?s.addClass(M):s[r?"addClass":"removeClass"](M);if(e&&r)a.hint(typeof e==="string"?l.replace(/日期/g,e):l)}};p.prototype.parse=function(e,t){var n=this,a=n.config,i=t||(e?H.extend({},n.endDate,n.endTime):a.range?H.extend({},n.startDate,n.startTime):a.dateTime),r=n.format.concat();H.each(r,function(e,t){if(/yyyy|y/.test(t)){r[e]=H.digit(i.year,t.length)}else if(/MM|M/.test(t)){r[e]=H.digit(i.month+1,t.length)}else if(/dd|d/.test(t)){r[e]=H.digit(i.date,t.length)}else if(/HH|H/.test(t)){r[e]=H.digit(i.hours,t.length)}else if(/mm|m/.test(t)){r[e]=H.digit(i.minutes,t.length)}else if(/ss|s/.test(t)){r[e]=H.digit(i.seconds,t.length)}});if(a.range&&!e){return r.join("")+" "+a.range+" "+n.parse(1)}return r.join("")};p.prototype.newDate=function(e){e=e||{};return new Date(e.year||1,e.month||0,e.date||1,e.hours||0,e.minutes||0,e.seconds||0)};p.prototype.setValue=function(e){var t=this,n=t.config,a=t.bindElem||n.elem[0],i=t.isInput(a)?"val":"html";n.position==="static"||H(a)[i](e||"");return this};p.prototype.stampRange=function(){var i=this,e=i.config,r,s,t=H(i.elem).find("td");if(e.range&&!i.endDate)H(i.footer).find(k).addClass(M);if(!i.endDate)return;r=i.newDate({year:i.startDate.year,month:i.startDate.month,date:i.startDate.date}).getTime();s=i.newDate({year:i.endDate.year,month:i.endDate.month,date:i.endDate.date}).getTime();if(r>s)return i.hint(l);H.each(t,function(e,t){var n=H(t).attr("lay-ymd").split("-"),a=i.newDate({year:n[0],month:n[1]-1,date:n[2]}).getTime();H(t).removeClass(d+" "+C);if(a===r||a===s){H(t).addClass(H(t).hasClass(c)||H(t).hasClass(m)?d:C)}if(a>r&&a<s){H(t).addClass(d)}})};p.prototype.done=function(e,t){var n=this,a=n.config,i=H.extend({},n.startDate?H.extend(n.startDate,n.startTime):a.dateTime),r=H.extend({},H.extend(n.endDate,n.endTime));H.each([i,r],function(e,t){if(!("month"in t))return;H.extend(t,{month:t.month+1})});e=e||[n.parse(),i,r];typeof a[t||"done"]==="function"&&a[t||"done"].apply(a,e);return n};p.prototype.choose=function(e){var n=this,a=n.config,i=a.dateTime,t=H(n.elem).find("td"),r=e.attr("lay-ymd").split("-"),s=function(e){var t=new Date;e&&H.extend(i,r);if(a.range){n.startDate?H.extend(n.startDate,r):n.startDate=H.extend({},r,n.startTime);n.startYMD=r}};r={year:r[0]|0,month:(r[1]|0)-1,date:r[2]|0};if(e.hasClass(M))return;if(a.range){H.each(["startTime","endTime"],function(e,t){n[t]=n[t]||{hours:0,minutes:0,seconds:0}});if(n.endState){s();delete n.endState;delete n.endDate;n.startState=true;t.removeClass(C+" "+d);e.addClass(C)}else if(n.startState){e.addClass(C);n.endDate?H.extend(n.endDate,r):n.endDate=H.extend({},r,n.endTime);if(n.newDate(r).getTime()<n.newDate(n.startYMD).getTime()){var o=H.extend({},n.endDate,{hours:n.startDate.hours,minutes:n.startDate.minutes,seconds:n.startDate.seconds});H.extend(n.endDate,n.startDate,{hours:n.endDate.hours,minutes:n.endDate.minutes,seconds:n.endDate.seconds});n.startDate=o}a.showBottom||n.done();n.stampRange();n.endState=true;n.done(null,"change")}else{e.addClass(C);s();n.startState=true}H(n.footer).find(k)[n.endDate?"removeClass":"addClass"](M)}else if(a.position==="static"){s(true);n.calendar().done().done(null,"change")}else if(a.type==="date"){s(true);n.setValue(n.parse()).remove().done()}else if(a.type==="datetime"){s(true);n.calendar().done(null,"change")}};p.prototype.tool=function(e,t){var n=this,a=n.config,i=a.dateTime,r=a.position==="static",s={datetime:function(){if(H(e).hasClass(M))return;n.list("time",0);a.range&&n.list("time",1);H(e).attr("lay-type","date").html(n.lang().dateTips)},date:function(){n.closeList();H(e).attr("lay-type","datetime").html(n.lang().timeTips)},clear:function(){n.setValue("").remove();r&&(H.extend(i,n.firstDate),n.calendar());a.range&&(delete n.startState,delete n.endState,delete n.endDate,delete n.startTime,delete n.endTime);n.done(["",{},{}])},now:function(){var e=new Date;H.extend(i,n.systemDate(),{hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()});n.setValue(n.parse()).remove();r&&n.calendar();n.done()},confirm:function(){if(a.range){if(!n.endDate)return n.hint("请先选择日期范围");if(H(e).hasClass(M))return n.hint(a.type==="time"?l.replace(/日期/g,"时间"):l)}else{if(H(e).hasClass(M))return n.hint("不在有效日期或时间范围内")}n.done();n.setValue(n.parse()).remove()}};s[t]&&s[t]()};p.prototype.change=function(i){var r=this,s=r.config,o=s.dateTime,l=s.range&&(s.type==="year"||s.type==="month"),d=r.elemCont[i||0],c=r.listYM[i],e=function(e){var t=["startDate","endDate"][i],n=H(d).find(".calendar-year-list")[0],a=H(d).find(".calendar-month-list")[0];if(n){c[0]=e?c[0]-15:c[0]+15;r.list("year",i)}if(a){e?c[0]--:c[0]++;r.list("month",i)}if(n||a){H.extend(o,{year:c[0]});if(l)r[t].year=c[0];s.range||r.done(null,"change");r.setBtnStatus();s.range||r.limit(H(r.footer).find(k),{year:c[0]})}return n||a};return{prevYear:function(){if(e("sub"))return;o.year--;r.checkDate("limit").calendar();s.range||r.done(null,"change")},prevMonth:function(){var e=r.getAsYM(o.year,o.month,"sub");H.extend(o,{year:e[0],month:e[1]});r.checkDate("limit").calendar();s.range||r.done(null,"change")},nextMonth:function(){var e=r.getAsYM(o.year,o.month);H.extend(o,{year:e[0],month:e[1]});r.checkDate("limit").calendar();s.range||r.done(null,"change")},nextYear:function(){if(e())return;o.year++;r.checkDate("limit").calendar();s.range||r.done(null,"change")}}};p.prototype.changeEvent=function(){var r=this,e=r.config;H(r.elem).on("click",function(e){H.stope(e)});H.each(r.elemHeader,function(i,e){H(e[0]).on("click",function(e){r.change(i).prevYear()});H(e[1]).on("click",function(e){r.change(i).prevMonth()});H(e[2]).find("span").on("click",function(e){var t=H(this),n=t.attr("lay-ym"),a=t.attr("lay-type");if(!n)return;n=n.split("-");r.listYM[i]=[n[0]|0,n[1]|0];r.list(a,i);H(r.footer).find(S).addClass(M)});H(e[3]).on("click",function(e){r.change(i).nextMonth()});H(e[4]).on("click",function(e){r.change(i).nextYear()})});H.each(r.table,function(e,t){var n=H(t).find("td");n.on("click",function(){r.choose(H(this))})});H(r.footer).find("span").on("click",function(){var e=H(this).attr("lay-type");r.tool(this,e)})};p.prototype.isInput=function(e){return/input|textarea/.test(e.tagName.toLocaleLowerCase())};p.prototype.events=function(){var n=this,a=n.config,e=function(e,t){e.on(a.trigger,function(){t&&(n.bindElem=this);n.render()})};if(!a.elem[0]||a.elem[0].eventHandler)return;e(a.elem,"bind");e(a.eventElem);H(document).on("click",function(e){if(e.target===a.elem[0]||e.target===a.eventElem[0]||e.target===H(a.closeStop)[0]){return}n.remove()}).on("keydown",function(e){if(e.keyCode===13){if(H("#"+n.elemID)[0]&&n.elemID===p.thisElem){e.preventDefault();H(n.footer).find(k)[0].click()}}});H(window).on("resize",function(){if(!n.elem||!H(i)[0]){return false}n.position()});a.elem[0].eventHandler=true};h.render=function(e){var t=new p(e);return n.call(t)};h.getEndDate=function(e,t){var n=new Date;n.setFullYear(t||n.getFullYear(),e||n.getMonth()+1,1);return new Date(n.getTime()-1e3*60*60*24).getDate()};this.render=h.render}if(typeof soxui!="undefined"){soxui.calendar=new e}else{window.soxcalendar=new e}})();