(function(){"use strict";function e(){this.version="1.0.0";this.modules=[];if(typeof soxui!="undefined"&&soxui.$){var e=soxui.$}else{if(typeof jQuery=="undefined"){typeof console=="object"&&console.error("soxcalendar error: sorry, jQuery is required, you must load it before this script.");return false}}var h={v:"5.0.9",config:{},index:0,set:function(e){var t=this;t.config=H.extend({},t.config,e);return t},ready:function(e){e();return this}},n=function(){var t=this;return{hint:function(e){t.hint.call(t,e)},config:t.config}},t="calendar",i=".soxui-calendar",C="soxui-this",a="soxui-show",r="soxui-hide",M="calendar-disabled",l="开始日期超出了结束日期<br>建议重新选择",p=[100,2e5],o="soxui-calendar-static",b="soxui-calendar-list",c="calendar-selected",s="soxui-calendar-hint",d="calendar-day-prev",u="calendar-day-next",m="soxui-calendar-footer",E=".calendar-btns-confirm",S="calendar-time-text",k=".calendar-btns-time",y=function(e){var t=this;t.index=++h.index;t.config=H.extend({},t.config,h.config,e);h.ready(function(){t.init()})},H=function(e){return new f(e)},f=function(e){var t=0,n=typeof e==="object"?[e]:(this.selector=e,document.querySelectorAll(e||null));for(;t<n.length;t++){this.push(n[t])}};f.prototype=[];f.prototype.constructor=f;H.extend=function(){var e=1,t=arguments,a=function(e,t){e=e||(t.constructor===Array?[]:{});for(var n in t){e[n]=t[n]&&t[n].constructor===Object?a(e[n],t[n]):t[n]}return e};t[0]=typeof t[0]==="object"?t[0]:{};for(;e<t.length;e++){if(typeof t[e]==="object"){a(t[0],t[e])}}return t[0]};H.ie=function(){var e=navigator.userAgent.toLowerCase();return!!window.ActiveXObject||"ActiveXObject"in window?(e.match(/msie\s(\d+)/)||[])[1]||"11":false}();H.stope=function(e){e=e||window.event;e.stopPropagation?e.stopPropagation():e.cancelBubble=true};H.each=function(e,t){var n,a=this;if(typeof t!=="function")return a;e=e||[];if(e.constructor===Object){for(n in e){if(t.call(e[n],n,e[n]))break}}else{for(n=0;n<e.length;n++){if(t.call(e[n],n,e[n]))break}}return a};H.digit=function(e,t,n){var a="";e=String(e);t=t||2;for(var i=e.length;i<t;i++){a+="0"}return e<Math.pow(10,t)?a+(e|0):e};H.elem=function(e,t){var n=document.createElement(e);H.each(t||{},function(e,t){n.setAttribute(e,t)});return n};f.addStr=function(n,e){n=n.replace(/\s+/," ");e=e.replace(/\s+/," ").split(" ");H.each(e,function(e,t){if(!new RegExp("\\b"+t+"\\b").test(n)){n=n+" "+t}});return n.replace(/^\s|\s$/,"")};f.removeStr=function(a,e){a=a.replace(/\s+/," ");e=e.replace(/\s+/," ").split(" ");H.each(e,function(e,t){var n=new RegExp("\\b"+t+"\\b");if(n.test(a)){a=a.replace(n,"")}});return a.replace(/\s+/," ").replace(/^\s|\s$/,"")};f.prototype.find=function(a){var i=this;var r=0,o=[],s=typeof a==="object";this.each(function(e,t){var n=s?[a]:t.querySelectorAll(a||null);for(;r<n.length;r++){o.push(n[r])}i.shift()});if(!s){i.selector=(i.selector?i.selector+" ":"")+a}H.each(o,function(e,t){i.push(t)});return i};f.prototype.each=function(e){return H.each.call(this,this,e)};f.prototype.addClass=function(n,a){return this.each(function(e,t){t.className=f[a?"removeStr":"addStr"](t.className,n)})};f.prototype.removeClass=function(e){return this.addClass(e,true)};f.prototype.hasClass=function(n){var a=false;this.each(function(e,t){if(new RegExp("\\b"+n+"\\b").test(t.className)){a=true}});return a};f.prototype.attr=function(n,a){var e=this;return a===undefined?function(){if(e.length>0)return e[0].getAttribute(n)}():e.each(function(e,t){t.setAttribute(n,a)})};f.prototype.removeAttr=function(n){return this.each(function(e,t){t.removeAttribute(n)})};f.prototype.html=function(n){return this.each(function(e,t){t.innerHTML=n})};f.prototype.val=function(a){return this.each(function(e,t){var n=t.value;t.value=a;if(a!=n)t.dispatchEvent(new Event("change",{bubbles:true}))})};f.prototype.append=function(n){return this.each(function(e,t){typeof n==="object"?t.appendChild(n):t.innerHTML=t.innerHTML+n})};f.prototype.remove=function(n){return this.each(function(e,t){n?t.removeChild(n):t.parentNode.removeChild(t)})};f.prototype.on=function(n,a){return this.each(function(e,t){t.attachEvent?t.attachEvent("on"+n,function(e){e.target=e.srcElement;a.call(t,e)}):t.addEventListener(n,a,false)})};f.prototype.off=function(n,a){return this.each(function(e,t){t.detachEvent?t.detachEvent("on"+n,a):t.removeEventListener(n,a,false)})};y.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0};y.prototype.config={type:"date",range:false,format:"yyyy-MM-dd",value:null,isInitValue:true,min:"1900-1-1",max:"2099-12-31",trigger:"focus",show:false,showBottom:true,btns:["clear","now","confirm"],lang:"cn",theme:"default",position:null,calendar:false,mark:{},zIndex:null,done:null,change:null};y.prototype.lang=function(){var e=this,t=e.config,n={cn:{weeks:["日","一","二","三","四","五","六"],time:["时","分","秒"],timeTips:"选择时间",startTime:"开始时间",endTime:"结束时间",dateTips:"返回日期",month:["一","二","三","四","五","六","七","八","九","十","十一","十二"],tools:{confirm:"确定",clear:"清空",now:"现在"}},en:{weeks:["Su","Mo","Tu","We","Th","Fr","Sa"],time:["Hours","Minutes","Seconds"],timeTips:"Select Time",startTime:"Start Time",endTime:"End Time",dateTips:"Select Date",month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],tools:{confirm:"Confirm",clear:"Clear",now:"Now"}}};return n[t.lang]||n["cn"]};y.prototype.init=function(){var a=this,l=a.config,i="yyyy|y|MM|M|dd|d|HH|H|mm|m|ss|s",e=l.position==="static",t={year:"yyyy",month:"yyyy-MM",date:"yyyy-MM-dd",time:"HH:mm:ss",datetime:"yyyy-MM-dd HH:mm:ss"};l.elem=H(l.elem);l.eventElem=H(l.eventElem);if(!l.elem[0])return;if(l.range===true)l.range="-";if(l.format===t.date){l.format=t[l.type]}a.format=l.format.match(new RegExp(i+"|.","g"))||[];a.EXP_IF="";a.EXP_SPLIT="";H.each(a.format,function(e,t){var n=new RegExp(i).test(t)?"\\d{"+function(){if(new RegExp(i).test(a.format[e===0?e+1:e-1]||"")){if(/^yyyy|y$/.test(t))return 4;return t.length}if(/^yyyy$/.test(t))return"1,4";if(/^y$/.test(t))return"1,308";return"1,2"}()+"}":"\\"+t;a.EXP_IF=a.EXP_IF+n;a.EXP_SPLIT=a.EXP_SPLIT+"("+n+")"});a.EXP_IF=new RegExp("^"+(l.range?a.EXP_IF+"\\s\\"+l.range+"\\s"+a.EXP_IF:a.EXP_IF)+"$");a.EXP_SPLIT=new RegExp("^"+a.EXP_SPLIT+"$","");if(!a.isInput(l.elem[0])){if(l.trigger==="focus"){l.trigger="click"}}if(!l.elem.attr("lay-key")){l.elem.attr("lay-key",a.index);l.eventElem.attr("lay-key",a.index)}l.mark=H.extend({},l.calendar&&l.lang==="cn"?{"0-1-1":"元旦","0-2-14":"情人","0-3-8":"妇女","0-3-12":"植树","0-4-1":"愚人","0-5-1":"劳动","0-5-4":"青年","0-6-1":"儿童","0-9-10":"教师","0-9-18":"国耻","0-10-1":"国庆","0-12-25":"圣诞"}:{},l.mark);H.each(["min","max"],function(e,t){var n=[],a=[];if(typeof l[t]==="number"){var i=l[t],r=(new Date).getTime(),o=864e5,s=new Date(i?i<o?r+i*o:i:r);n=[s.getFullYear(),s.getMonth()+1,s.getDate()];i<o||(a=[s.getHours(),s.getMinutes(),s.getSeconds()])}else{n=(l[t].match(/\d+-\d+-\d+/)||[""])[0].split("-");a=(l[t].match(/\d+:\d+:\d+/)||[""])[0].split(":")}l[t]={year:n[0]|0||(new Date).getFullYear(),month:n[1]?(n[1]|0)-1:(new Date).getMonth(),date:n[2]|0||(new Date).getDate(),hours:a[0]|0,minutes:a[1]|0,seconds:a[2]|0}});a.elemID="soxui-calendar"+l.elem.attr("lay-key");if(l.show||e)a.render();e||a.events();if(l.value&&l.isInitValue){if(l.value.constructor===Date){a.setValue(a.parse(0,a.systemDate(l.value)))}else{a.setValue(l.value)}}};y.prototype.render=function(){var e=this,s=e.config,l=e.lang(),i=s.position==="static",n=e.elem=H.elem("div",{id:e.elemID,class:["soxui-calendar",s.range?" soxui-calendar-range":"",i?" "+o:"",s.theme&&s.theme!=="default"&&!/^#/.test(s.theme)?" calendar-theme-"+s.theme:""].join("")}),c=e.elemMain=[],d=e.elemHeader=[],u=e.elemCont=[],f=e.table=[],t=e.footer=H.elem("div",{class:m});if(s.zIndex)n.style.zIndex=s.zIndex;H.each(new Array(2),function(e){if(!s.range&&e>0){return true}var n=H.elem("div",{class:"soxui-calendar-header"}),t=[function(){var e=H.elem("i",{class:"soxui-icon calendar-icon calendar-prev-y"});e.innerHTML="&#xe65a;";return e}(),function(){var e=H.elem("i",{class:"soxui-icon calendar-icon calendar-prev-m"});e.innerHTML="&#xe603;";return e}(),function(){var e=H.elem("div",{class:"calendar-set-ym"}),t=H.elem("span"),n=H.elem("span");e.appendChild(t);e.appendChild(n);return e}(),function(){var e=H.elem("i",{class:"soxui-icon calendar-icon calendar-next-m"});e.innerHTML="&#xe602;";return e}(),function(){var e=H.elem("i",{class:"soxui-icon calendar-icon calendar-next-y"});e.innerHTML="&#xe65b;";return e}()],a=H.elem("div",{class:"soxui-calendar-content"}),i=H.elem("table"),r=H.elem("thead"),o=H.elem("tr");H.each(t,function(e,t){n.appendChild(t)});r.appendChild(o);H.each(new Array(6),function(n){var a=i.insertRow(0);H.each(new Array(7),function(e){if(n===0){var t=H.elem("th");t.innerHTML=l.weeks[e];o.appendChild(t)}a.insertCell(e)})});i.insertBefore(r,i.children[0]);a.appendChild(i);c[e]=H.elem("div",{class:"soxui-calendar-main calendar-main-list-"+e});c[e].appendChild(n);c[e].appendChild(a);d.push(t);u.push(a);f.push(i)});H(t).html(function(){var e=[],a=[];if(s.type==="datetime"){e.push('<span lay-type="datetime" class="calendar-btns-time">'+l.timeTips+"</span>")}H.each(s.btns,function(e,t){var n=l.tools[t]||"btn";if(s.range&&t==="now")return;if(i&&t==="clear")n=s.lang==="cn"?"重置":"Reset";a.push('<span lay-type="'+t+'" class="calendar-btns-'+t+'">'+n+"</span>")});e.push('<div class="calendar-footer-btns">'+a.join("")+"</div>");return e.join("")}());H.each(c,function(e,t){n.appendChild(t)});s.showBottom&&n.appendChild(t);if(/^#/.test(s.theme)){var a=H.elem("style"),r=["#{{id}} .soxui-calendar-header{background-color:{{theme}};}","#{{id}} .soxui-this{background-color:{{theme}} !important;}"].join("").replace(/{{id}}/g,e.elemID).replace(/{{theme}}/g,s.theme);if("styleSheet"in a){a.setAttribute("type","text/css");a.styleSheet.cssText=r}else{a.innerHTML=r}H(n).addClass("calendar-theme-molv");n.appendChild(a)}e.remove(y.thisElemDate);i?s.elem.append(n):(document.body.appendChild(n),e.position());e.checkDate().calendar();e.changeEvent();y.thisElemDate=e.elemID;typeof s.ready==="function"&&s.ready(H.extend({},s.dateTime,{month:s.dateTime.month+1}))};y.prototype.remove=function(e){var t=this,n=t.config,a=H("#"+(e||t.elemID));if(!a.hasClass(o)){t.checkDate(function(){a.remove()})}return t};y.prototype.position=function(){var e=this,t=e.config,n=e.bindElem||t.elem[0],a=n.getBoundingClientRect(),i=e.elem.offsetWidth,r=e.elem.offsetHeight,o=function(e){e=e?"scrollLeft":"scrollTop";return document.body[e]|document.documentElement[e]},s=function(e){return document.documentElement[e?"clientWidth":"clientHeight"]},l=5,c=a.left,d=a.bottom;if(c+i+l>s("width")){c=s("width")-i-l}if(d+r+l>s()){d=a.top>r?a.top-r:s()-r;d=d-l*2}if(t.position){e.elem.style.position=t.position}e.elem.style.left=c+(t.position==="fixed"?0:o(1))+"px";e.elem.style.top=d+(t.position==="fixed"?0:o())+"px"};y.prototype.hint=function(e){var t=this,n=t.config,a=H.elem("div",{class:s});if(!t.elem)return;a.innerHTML=e||"";H(t.elem).find("."+s).remove();t.elem.appendChild(a);clearTimeout(t.hinTimer);t.hinTimer=setTimeout(function(){H(t.elem).find("."+s).remove()},3e3)};y.prototype.getAsYM=function(e,t,n){n?t--:t++;if(t<0){t=11;e--}if(t>11){t=0;e++}return[e,t]};y.prototype.systemDate=function(e){var t=e||new Date;return{year:t.getFullYear(),month:t.getMonth(),date:t.getDate(),hours:e?e.getHours():0,minutes:e?e.getMinutes():0,seconds:e?e.getSeconds():0}};y.prototype.checkDate=function(e){var s=this,t=new Date,l=s.config,n=l.dateTime=l.dateTime||s.systemDate(),a,c,i=s.bindElem||l.elem[0],r=s.isInput(i)?"val":"html",o=s.isInput(i)?i.value:l.position==="static"?"":i.innerHTML,d=function(e){if(e.year>p[1])e.year=p[1],c=true;if(e.month>11)e.month=11,c=true;if(e.hours>23)e.hours=0,c=true;if(e.minutes>59)e.minutes=0,e.hours++,c=true;if(e.seconds>59)e.seconds=0,e.minutes++,c=true;a=h.getEndDate(e.month+1,e.year);if(e.date>a)e.date=a,c=true},u=function(a,i,r){var o=["startTime","endTime"];i=(i.match(s.EXP_SPLIT)||[]).slice(1);r=r||0;if(l.range){s[o[r]]=s[o[r]]||{}}H.each(s.format,function(e,t){var n=parseFloat(i[e]);if(i[e].length<t.length)c=true;if(/yyyy|y/.test(t)){if(n<p[0])n=p[0],c=true;a.year=n}else if(/MM|M/.test(t)){if(n<1)n=1,c=true;a.month=n-1}else if(/dd|d/.test(t)){if(n<1)n=1,c=true;a.date=n}else if(/HH|H/.test(t)){if(n<1)n=0,c=true;a.hours=n;l.range&&(s[o[r]].hours=n)}else if(/mm|m/.test(t)){if(n<1)n=0,c=true;a.minutes=n;l.range&&(s[o[r]].minutes=n)}else if(/ss|s/.test(t)){if(n<1)n=0,c=true;a.seconds=n;l.range&&(s[o[r]].seconds=n)}});d(a)};if(e==="limit")return d(n),s;o=o||l.value;if(typeof o==="string"){o=o.replace(/\s+/g," ").replace(/^\s|\s$/g,"")}if(s.startState&&!s.endState){delete s.startState;s.endState=true}if(typeof o==="string"&&o){if(s.EXP_IF.test(o)){if(l.range){o=o.split(" "+l.range+" ");s.startDate=s.startDate||s.systemDate();s.endDate=s.endDate||s.systemDate();l.dateTime=H.extend({},s.startDate);H.each([s.startDate,s.endDate],function(e,t){u(t,o[e],e)})}else{u(n,o)}}else{s.hint("日期格式不合法<br>必须遵循下述格式：<br>"+(l.range?l.format+" "+l.range+" "+l.format:l.format)+"<br>已为你重置");c=true}}else if(o&&o.constructor===Date){l.dateTime=s.systemDate(o)}else{l.dateTime=s.systemDate();delete s.startState;delete s.endState;delete s.startDate;delete s.endDate;delete s.startTime;delete s.endTime}d(n);if(c&&o){s.setValue(l.range?s.endDate?s.parse():"":s.parse())}e&&e();return s};y.prototype.mark=function(e,a){var t=this,i,n=t.config;H.each(n.mark,function(e,t){var n=e.split("-");if((n[0]==a[0]||n[0]==0)&&(n[1]==a[1]||n[1]==0)&&n[2]==a[2]){i=t||a[2]}});i&&e.html('<span class="calendar-day-mark">'+i+"</span>");return t};y.prototype.limit=function(e,t,n,i){var r=this,a=r.config,o={},s=a[n>41?"endDate":"dateTime"],l,c=H.extend({},s,t||{});H.each({now:c,min:a.min,max:a.max},function(e,a){o[e]=r.newDate(H.extend({year:a.year,month:a.month,date:a.date},function(){var n={};H.each(i,function(e,t){n[t]=a[t]});return n}())).getTime()});l=o.now<o.min||o.now>o.max;e&&e[l?"addClass":"removeClass"](M);return l};y.prototype.calendar=function(e){var i=this,r=i.config,o=e||r.dateTime,t=new Date,s,l,c,n=i.lang(),a=r.type!=="date"&&r.type!=="datetime",d=e?1:0,u=H(i.table[d]).find("td"),f=H(i.elemHeader[d][2]).find("span");if(o.year<p[0])o.year=p[0],i.hint("最低只能支持到公元"+p[0]+"年");if(o.year>p[1])o.year=p[1],i.hint("最高只能支持到公元"+p[1]+"年");if(!i.firstDate){i.firstDate=H.extend({},o)}t.setFullYear(o.year,o.month,1);s=t.getDay();l=h.getEndDate(o.month||12,o.year);c=h.getEndDate(o.month+1,o.year);H.each(u,function(e,t){var n=[o.year,o.month],a=0;t=H(t);t.removeAttr("class");if(e<s){a=l-s+e;t.addClass("calendar-day-prev");n=i.getAsYM(o.year,o.month,"sub")}else if(e>=s&&e<c+s){a=e-s;if(!r.range){a+1===o.date&&t.addClass(C)}}else{a=e-c-s;t.addClass("calendar-day-next");n=i.getAsYM(o.year,o.month)}n[1]++;n[2]=a+1;t.attr("lay-ymd",n.join("-")).html(n[2]);i.mark(t,n).limit(t,{year:n[0],month:n[1]-1,date:n[2]},e)});H(f[0]).attr("lay-ym",o.year+"-"+(o.month+1));H(f[1]).attr("lay-ym",o.year+"-"+(o.month+1));if(r.lang==="cn"){H(f[0]).attr("lay-type","year").html(o.year+"年");H(f[1]).attr("lay-type","month").html(o.month+1+"月")}else{H(f[0]).attr("lay-type","month").html(n.month[o.month]);H(f[1]).attr("lay-type","year").html(o.year)}if(a){if(r.range){e?i.endDate=i.endDate||{year:o.year+(r.type==="year"?1:0),month:o.month+(r.type==="month"?0:-1)}:i.startDate=i.startDate||{year:o.year,month:o.month};if(e){i.listYM=[[i.startDate.year,i.startDate.month+1],[i.endDate.year,i.endDate.month+1]];i.list(r.type,0).list(r.type,1);r.type==="time"?i.setBtnStatus("时间",H.extend({},i.systemDate(),i.startTime),H.extend({},i.systemDate(),i.endTime)):i.setBtnStatus(true)}}if(!r.range){i.listYM=[[o.year,o.month+1]];i.list(r.type,0)}}if(r.range&&!e){var m=i.getAsYM(o.year,o.month);i.calendar(H.extend({},o,{year:m[0],month:m[1]}))}if(!r.range)i.limit(H(i.footer).find(E),null,0,["hours","minutes","seconds"]);if(r.range&&e&&!a)i.stampRange();return i};y.prototype.list=function(n,a){var i=this,r=i.config,o=r.dateTime,s=i.lang(),l=r.range&&r.type!=="date"&&r.type!=="datetime",c=H.elem("ul",{class:b+" "+{year:"calendar-year-list",month:"calendar-month-list",time:"calendar-time-list"}[n]}),e=i.elemHeader[a],t=H(e[2]).find("span"),d=i.elemCont[a||0],u=H(d).find("."+b)[0],f=r.lang==="cn",m=f?"年":"",h=i.listYM[a]||{},p=["hours","minutes","seconds"],y=["startTime","endTime"][a];if(h[0]<1)h[0]=1;if(n==="year"){var g,v=g=h[0]-7;if(v<1)v=g=1;H.each(new Array(15),function(e){var t=H.elem("li",{"lay-ym":g}),n={year:g};g==h[0]&&H(t).addClass(C);t.innerHTML=g+m;c.appendChild(t);if(g<i.firstDate.year){n.month=r.min.month;n.date=r.min.date}else if(g>=i.firstDate.year){n.month=r.max.month;n.date=r.max.date}i.limit(H(t),n,a);g++});H(t[f?0:1]).attr("lay-ym",g-8+"-"+h[1]).html(v+m+" - "+(g-1+m))}else if(n==="month"){H.each(new Array(12),function(e){var t=H.elem("li",{"lay-ym":e}),n={year:h[0],month:e};e+1==h[1]&&H(t).addClass(C);t.innerHTML=s.month[e]+(f?"月":"");c.appendChild(t);if(h[0]<i.firstDate.year){n.date=r.min.date}else if(h[0]>=i.firstDate.year){n.date=r.max.date}i.limit(H(t),n,a)});H(t[f?0:1]).attr("lay-ym",h[0]+"-"+h[1]).html(h[0]+m)}else if(n==="time"){var D=function(){H(c).find("ol").each(function(n,e){H(e).find("li").each(function(e,t){i.limit(H(t),[{hours:e},{hours:i[y].hours,minutes:e},{hours:i[y].hours,minutes:i[y].minutes,seconds:e}][n],a,[["hours"],["hours","minutes"],["hours","minutes","seconds"]][n])})});if(!r.range)i.limit(H(i.footer).find(E),i[y],0,["hours","minutes","seconds"])};if(r.range){if(!i[y])i[y]={hours:0,minutes:0,seconds:0}}else{i[y]=o}H.each([24,60,60],function(t,e){var n=H.elem("li"),a=["<p>"+s.time[t]+"</p><ol>"];H.each(new Array(e),function(e){a.push("<li"+(i[y][p[t]]===e?' class="'+C+'"':"")+">"+H.digit(e,2)+"</li>")});n.innerHTML=a.join("")+"</ol>";c.appendChild(n)});D()}if(u)d.removeChild(u);d.appendChild(c);if(n==="year"||n==="month"){H(i.elemMain[a]).addClass("calendar-ym-show");H(c).find("li").on("click",function(){var e=H(this).attr("lay-ym")|0;if(H(this).hasClass(M))return;if(a===0){o[n]=e;if(l)i.startDate[n]=e;i.limit(H(i.footer).find(E),null,0)}else{if(l){i.endDate[n]=e}else{var t=n==="year"?i.getAsYM(e,h[1]-1,"sub"):i.getAsYM(h[0],e,"sub");H.extend(o,{year:t[0],month:t[1]})}}if(r.type==="year"||r.type==="month"){H(c).find("."+C).removeClass(C);H(this).addClass(C);if(r.type==="month"&&n==="year"){i.listYM[a][0]=e;l&&(i[["startDate","endDate"][a]].year=e);i.list("month",a)}}else{i.checkDate("limit").calendar();i.closeList()}i.setBtnStatus();r.range||i.done(null,"change");H(i.footer).find(k).removeClass(M)})}else{var x=H.elem("span",{class:S}),T=function(){H(c).find("ol").each(function(e){var n=this,t=H(n).find("li");n.scrollTop=30*(i[y][p[e]]-2);if(n.scrollTop<=0){t.each(function(e,t){if(!H(this).hasClass(M)){n.scrollTop=30*(e-2);return true}})}})},w=H(e[2]).find("."+S);T();x.innerHTML=r.range?[s.startTime,s.endTime][a]:s.timeTips;H(i.elemMain[a]).addClass("calendar-time-show");if(w[0])w.remove();e[2].appendChild(x);H(c).find("ol").each(function(t){var n=this;H(n).find("li").on("click",function(){var e=this.innerHTML|0;if(H(this).hasClass(M))return;if(r.range){i[y][p[t]]=e}else{o[p[t]]=e}H(n).find("."+C).removeClass(C);H(this).addClass(C);D();T();(i.endDate||r.type==="time")&&i.done(null,"change");i.setBtnStatus()})})}return i};y.prototype.listYM=[];y.prototype.closeList=function(){var n=this,e=n.config;H.each(n.elemCont,function(e,t){H(this).find("."+b).remove();H(n.elemMain[e]).removeClass("calendar-ym-show calendar-time-show")});H(n.elem).find("."+S).remove()};y.prototype.setBtnStatus=function(e,t,n){var a=this,i=a.config,r,o=H(a.footer).find(E),s=i.range&&i.type!=="date"&&i.type!=="time";if(s){t=t||a.startDate;n=n||a.endDate;r=a.newDate(t).getTime()>a.newDate(n).getTime();a.limit(null,t)||a.limit(null,n)?o.addClass(M):o[r?"addClass":"removeClass"](M);if(e&&r)a.hint(typeof e==="string"?l.replace(/日期/g,e):l)}};y.prototype.parse=function(e,t){var n=this,a=n.config,i=t||(e?H.extend({},n.endDate,n.endTime):a.range?H.extend({},n.startDate,n.startTime):a.dateTime),r=n.format.concat();H.each(r,function(e,t){if(/yyyy|y/.test(t)){r[e]=H.digit(i.year,t.length)}else if(/MM|M/.test(t)){r[e]=H.digit(i.month+1,t.length)}else if(/dd|d/.test(t)){r[e]=H.digit(i.date,t.length)}else if(/HH|H/.test(t)){r[e]=H.digit(i.hours,t.length)}else if(/mm|m/.test(t)){r[e]=H.digit(i.minutes,t.length)}else if(/ss|s/.test(t)){r[e]=H.digit(i.seconds,t.length)}});if(a.range&&!e){return r.join("")+" "+a.range+" "+n.parse(1)}return r.join("")};y.prototype.newDate=function(e){e=e||{};return new Date(e.year||1,e.month||0,e.date||1,e.hours||0,e.minutes||0,e.seconds||0)};y.prototype.setValue=function(e){var t=this,n=t.config,a=t.bindElem||n.elem[0],i=t.isInput(a)?"val":"html";n.position==="static"||H(a)[i](e||"");return this};y.prototype.stampRange=function(){var i=this,e=i.config,r,o,t=H(i.elem).find("td");if(e.range&&!i.endDate)H(i.footer).find(E).addClass(M);if(!i.endDate)return;r=i.newDate({year:i.startDate.year,month:i.startDate.month,date:i.startDate.date}).getTime();o=i.newDate({year:i.endDate.year,month:i.endDate.month,date:i.endDate.date}).getTime();if(r>o)return i.hint(l);H.each(t,function(e,t){var n=H(t).attr("lay-ymd").split("-"),a=i.newDate({year:n[0],month:n[1]-1,date:n[2]}).getTime();H(t).removeClass(c+" "+C);if(a===r||a===o){H(t).addClass(H(t).hasClass(d)||H(t).hasClass(u)?c:C)}if(a>r&&a<o){H(t).addClass(c)}})};y.prototype.done=function(e,t){var n=this,a=n.config,i=H.extend({},n.startDate?H.extend(n.startDate,n.startTime):a.dateTime),r=H.extend({},H.extend(n.endDate,n.endTime));H.each([i,r],function(e,t){if(!("month"in t))return;H.extend(t,{month:t.month+1})});e=e||[n.parse(),i,r];typeof a[t||"done"]==="function"&&a[t||"done"].apply(a,e);return n};y.prototype.choose=function(e){var n=this,a=n.config,i=a.dateTime,t=H(n.elem).find("td"),r=e.attr("lay-ymd").split("-"),o=function(e){var t=new Date;e&&H.extend(i,r);if(a.range){n.startDate?H.extend(n.startDate,r):n.startDate=H.extend({},r,n.startTime);n.startYMD=r}};r={year:r[0]|0,month:(r[1]|0)-1,date:r[2]|0};if(e.hasClass(M))return;if(a.range){H.each(["startTime","endTime"],function(e,t){n[t]=n[t]||{hours:0,minutes:0,seconds:0}});if(n.endState){o();delete n.endState;delete n.endDate;n.startState=true;t.removeClass(C+" "+c);e.addClass(C)}else if(n.startState){e.addClass(C);n.endDate?H.extend(n.endDate,r):n.endDate=H.extend({},r,n.endTime);if(n.newDate(r).getTime()<n.newDate(n.startYMD).getTime()){var s=H.extend({},n.endDate,{hours:n.startDate.hours,minutes:n.startDate.minutes,seconds:n.startDate.seconds});H.extend(n.endDate,n.startDate,{hours:n.endDate.hours,minutes:n.endDate.minutes,seconds:n.endDate.seconds});n.startDate=s}a.showBottom||n.done();n.stampRange();n.endState=true;n.done(null,"change")}else{e.addClass(C);o();n.startState=true}H(n.footer).find(E)[n.endDate?"removeClass":"addClass"](M)}else if(a.position==="static"){o(true);n.calendar().done().done(null,"change")}else if(a.type==="date"){o(true);n.setValue(n.parse()).remove().done()}else if(a.type==="datetime"){o(true);n.calendar().done(null,"change")}};y.prototype.tool=function(e,t){var n=this,a=n.config,i=a.dateTime,r=a.position==="static",o={datetime:function(){if(H(e).hasClass(M))return;n.list("time",0);a.range&&n.list("time",1);H(e).attr("lay-type","date").html(n.lang().dateTips)},date:function(){n.closeList();H(e).attr("lay-type","datetime").html(n.lang().timeTips)},clear:function(){n.setValue("").remove();r&&(H.extend(i,n.firstDate),n.calendar());a.range&&(delete n.startState,delete n.endState,delete n.endDate,delete n.startTime,delete n.endTime);n.done(["",{},{}])},now:function(){var e=new Date;H.extend(i,n.systemDate(),{hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()});n.setValue(n.parse()).remove();r&&n.calendar();n.done()},confirm:function(){if(a.range){if(!n.endDate)return n.hint("请先选择日期范围");if(H(e).hasClass(M))return n.hint(a.type==="time"?l.replace(/日期/g,"时间"):l)}else{if(H(e).hasClass(M))return n.hint("不在有效日期或时间范围内")}n.done();n.setValue(n.parse()).remove()}};o[t]&&o[t]()};y.prototype.change=function(i){var r=this,o=r.config,s=o.dateTime,l=o.range&&(o.type==="year"||o.type==="month"),c=r.elemCont[i||0],d=r.listYM[i],e=function(e){var t=["startDate","endDate"][i],n=H(c).find(".calendar-year-list")[0],a=H(c).find(".calendar-month-list")[0];if(n){d[0]=e?d[0]-15:d[0]+15;r.list("year",i)}if(a){e?d[0]--:d[0]++;r.list("month",i)}if(n||a){H.extend(s,{year:d[0]});if(l)r[t].year=d[0];o.range||r.done(null,"change");r.setBtnStatus();o.range||r.limit(H(r.footer).find(E),{year:d[0]})}return n||a};return{prevYear:function(){if(e("sub"))return;s.year--;r.checkDate("limit").calendar();o.range||r.done(null,"change")},prevMonth:function(){var e=r.getAsYM(s.year,s.month,"sub");H.extend(s,{year:e[0],month:e[1]});r.checkDate("limit").calendar();o.range||r.done(null,"change")},nextMonth:function(){var e=r.getAsYM(s.year,s.month);H.extend(s,{year:e[0],month:e[1]});r.checkDate("limit").calendar();o.range||r.done(null,"change")},nextYear:function(){if(e())return;s.year++;r.checkDate("limit").calendar();o.range||r.done(null,"change")}}};y.prototype.changeEvent=function(){var r=this,e=r.config;H(r.elem).on("click",function(e){H.stope(e)});H.each(r.elemHeader,function(i,e){H(e[0]).on("click",function(e){r.change(i).prevYear()});H(e[1]).on("click",function(e){r.change(i).prevMonth()});H(e[2]).find("span").on("click",function(e){var t=H(this),n=t.attr("lay-ym"),a=t.attr("lay-type");if(!n)return;n=n.split("-");r.listYM[i]=[n[0]|0,n[1]|0];r.list(a,i);H(r.footer).find(k).addClass(M)});H(e[3]).on("click",function(e){r.change(i).nextMonth()});H(e[4]).on("click",function(e){r.change(i).nextYear()})});H.each(r.table,function(e,t){var n=H(t).find("td");n.on("click",function(){r.choose(H(this))})});H(r.footer).find("span").on("click",function(){var e=H(this).attr("lay-type");r.tool(this,e)})};y.prototype.isInput=function(e){return/input|textarea/.test(e.tagName.toLocaleLowerCase())};y.prototype.events=function(){var n=this,a=n.config,e=function(e,t){e.on(a.trigger,function(){t&&(n.bindElem=this);n.render()})};if(!a.elem[0]||a.elem[0].eventHandler)return;e(a.elem,"bind");e(a.eventElem);H(document).on("click",function(e){if(e.target===a.elem[0]||e.target===a.eventElem[0]||e.target===H(a.closeStop)[0]){return}n.remove()}).on("keydown",function(e){if(e.keyCode===13){if(H("#"+n.elemID)[0]&&n.elemID===y.thisElem){e.preventDefault();H(n.footer).find(E)[0].click()}}});H(window).on("resize",function(){if(!n.elem||!H(i)[0]){return false}n.position()});a.elem[0].eventHandler=true};h.render=function(e){var t=new y(e);return n.call(t)};h.getEndDate=function(e,t){var n=new Date;n.setFullYear(t||n.getFullYear(),e||n.getMonth()+1,1);return new Date(n.getTime()-1e3*60*60*24).getDate()};this.render=h.render}if(typeof soxui!="undefined"){soxui.calendar=new e}else{window.soxcalendar=new e}})();