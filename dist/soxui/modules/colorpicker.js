(function(){"use strict";function e(){this.version="1.0.0";this.modules=[];if(typeof soxui!="undefined"&&soxui.$){var x=soxui.$}else{if(typeof jQuery=="undefined"){typeof console=="object"&&console.error("soxcalendar error: sorry, jQuery is required, you must load it before this script.");return false}}var o={config:{},index:soxui.colorpicker?soxui.colorpicker.index+1e4:0,set:function(e){var i=this;i.config=x.extend({},i.config,e);return i},on:function(e,i){return soxui.onevent.call(this,"colorpicker",e,i)}},r=function(){var e=this,i=e.config;return{config:i}},e="colorpicker",n="soxui-show",i="soxui-this",t="soxui-colorpicker",s=".soxui-colorpicker-main",y="soxui-icon-down",P="soxui-icon-close",C="soxui-colorpicker-trigger-span",B="soxui-colorpicker-trigger-i",w="soxui-colorpicker-side",D="soxui-colorpicker-side-slider",E="soxui-colorpicker-basis",H="soxui-colorpicker-alpha-bgcolor",j="soxui-colorpicker-alpha-slider",W="soxui-colorpicker-basis-cursor",F="soxui-colorpicker-main-input",L=function(e){var i={h:0,s:0,b:0};var o=Math.min(e.r,e.g,e.b);var r=Math.max(e.r,e.g,e.b);var t=r-o;i.b=r;i.s=r!=0?255*t/r:0;if(i.s!=0){if(e.r==r){i.h=(e.g-e.b)/t}else if(e.g==r){i.h=2+(e.b-e.r)/t}else{i.h=4+(e.r-e.g)/t}}else{i.h=-1}if(r==o){i.h=0}i.h*=60;if(i.h<0){i.h+=360}i.s*=100/255;i.b*=100/255;return i},f=function(e){var e=e.indexOf("#")>-1?e.substring(1):e;if(e.length==3){var i=e.split("");e=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]}e=parseInt(e,16);var o={r:e>>16,g:(e&65280)>>8,b:e&255};return L(o)},M=function(e){var i={};var o=e.h;var r=e.s*255/100;var t=e.b*255/100;if(r==0){i.r=i.g=i.b=t}else{var n=t;var s=(255-r)*t/255;var c=(n-s)*(o%60)/60;if(o==360)o=0;if(o<60){i.r=n;i.b=s;i.g=s+c}else if(o<120){i.g=n;i.b=s;i.r=n-c}else if(o<180){i.g=n;i.r=s;i.b=s+c}else if(o<240){i.b=n;i.r=s;i.g=n-c}else if(o<300){i.b=n;i.g=s;i.r=s+c}else if(o<360){i.r=n;i.g=s;i.b=n-c}else{i.r=0;i.g=0;i.b=0}}return{r:Math.round(i.r),g:Math.round(i.g),b:Math.round(i.b)}},u=function(e){var i=M(e);var o=[i.r.toString(16),i.g.toString(16),i.b.toString(16)];x.each(o,function(e,i){if(i.length==1){o[e]="0"+i}});return o.join("")},Y=function(e){var i=/[0-9]{1,3}/g;var o=e.match(i)||[];return{r:o[0],g:o[1],b:o[2]}},I=x(window),c=x(document),l=function(e){var i=this;i.index=++o.index;i.config=x.extend({},i.config,o.config,e);i.render()};l.prototype.config={color:"",size:null,alpha:false,format:"hex",predefine:false,colors:["#009688","#5FB878","#1E9FFF","#FF5722","#FFB800","#01AAED","#999","#c00","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgb(0, 186, 189)","rgb(255, 120, 0)","rgb(250, 212, 0)","#393D49","rgba(0,0,0,.5)","rgba(255, 69, 0, 0.68)","rgba(144, 240, 144, 0.5)","rgba(31, 147, 255, 0.73)"]};l.prototype.render=function(){var e=this,i=e.config,o=x(['<div class="soxui-unselect soxui-colorpicker">',"<span "+(i.format=="rgb"&&i.alpha?'class="soxui-colorpicker-trigger-bgcolor"':"")+">",'<span class="soxui-colorpicker-trigger-span" ','lay-type="'+(i.format=="rgb"?i.alpha?"rgba":"torgb":"")+'" ','style="'+function(){var e="";if(i.color){e=i.color;if((i.color.match(/[0-9]{1,3}/g)||[]).length>3){if(!(i.alpha&&i.format=="rgb")){e="#"+u(L(Y(i.color)))}}return"background: "+e}return e}()+'">','<i class="soxui-icon soxui-colorpicker-trigger-i '+(i.color?y:P)+'"></i>',"</span>","</span>","</div>"].join(""));var r=x(i.elem);i.size&&o.addClass("soxui-colorpicker-"+i.size);r.addClass("soxui-inline").html(e.elemColorBox=o);e.color=e.elemColorBox.find("."+C)[0].style.background;e.events()};l.prototype.renderPicker=function(){var e=this,i=e.config,o=e.elemColorBox[0],r=e.elemPicker=x(['<div id="soxui-colorpicker'+e.index+'" data-index="'+e.index+'" class="soxui-anim soxui-anim-upbit soxui-colorpicker-main">','<div class="soxui-colorpicker-main-wrapper">','<div class="soxui-colorpicker-basis">','<div class="soxui-colorpicker-basis-white"></div>','<div class="soxui-colorpicker-basis-black"></div>','<div class="soxui-colorpicker-basis-cursor"></div>',"</div>",'<div class="soxui-colorpicker-side">','<div class="soxui-colorpicker-side-slider"></div>',"</div>","</div>",'<div class="soxui-colorpicker-main-alpha '+(i.alpha?n:"")+'">','<div class="soxui-colorpicker-alpha-bgcolor">','<div class="soxui-colorpicker-alpha-slider"></div>',"</div>","</div>",function(){if(i.predefine){var o=['<div class="soxui-colorpicker-main-pre">'];x.each(i.colors,function(e,i){o.push(['<div class="soxui-colorpicker-pre'+((i.match(/[0-9]{1,3}/g)||[]).length>3?" soxui-colorpicker-pre-isalpha":"")+'">','<div style="background:'+i+'"></div>',"</div>"].join(""))});o.push("</div>");return o.join("")}else{return""}}(),'<div class="soxui-colorpicker-main-input">','<div class="soxui-inline">','<input type="text" class="soxui-input">',"</div>",'<div class="soxui-btn-container">','<button class="soxui-btn soxui-btn-primary soxui-btn-sm" colorpicker-events="clear">清空</button>','<button class="soxui-btn soxui-btn-sm" colorpicker-events="confirm">确定</button>',"</div","</div>","</div>"].join("")),t=e.elemColorBox.find("."+C)[0];if(x(s)[0]&&x(s).data("index")==e.index){e.removePicker(l.thisElemInd)}else{e.removePicker(l.thisElemInd);x("body").append(r)}l.thisElemInd=e.index;l.thisColor=o.style.background;e.position();e.pickerEvents()};l.prototype.removePicker=function(e){var i=this,o=i.config;x("#soxui-colorpicker"+(e||i.index)).remove();return i};l.prototype.position=function(){var e=this,i=e.config,o=e.bindElem||e.elemColorBox[0],r=e.elemPicker[0],t=o.getBoundingClientRect(),n=r.offsetWidth,s=r.offsetHeight,c=function(e){e=e?"scrollLeft":"scrollTop";return document.body[e]|document.documentElement[e]},l=function(e){return document.documentElement[e?"clientWidth":"clientHeight"]},a=5,f=t.left,u=t.bottom;f=f-(n-o.offsetWidth)/2;u=u+a;if(f+n+a>l("width")){f=l("width")-n-a}else if(f<a){f=a}if(u+s+a>l()){u=t.top>s?t.top-s:l()-s;u=u-a*2}if(i.position){r.style.position=i.position}r.style.left=f+(i.position==="fixed"?0:c(1))+"px";r.style.top=u+(i.position==="fixed"?0:c())+"px"};l.prototype.val=function(){var e=this,i=e.config,o=e.elemColorBox.find("."+C),r=e.elemPicker.find("."+F),t=o[0],n=t.style.backgroundColor;if(n){var s=L(Y(n)),c=o.attr("lay-type");e.select(s.h,s.s,s.b);if(c==="torgb"){r.find("input").val(n)}if(c==="rgba"){var l=Y(n);if((n.match(/[0-9]{1,3}/g)||[]).length==3){r.find("input").val("rgba("+l.r+", "+l.g+", "+l.b+", 1)");e.elemPicker.find("."+j).css("left",280)}else{r.find("input").val(n);var a=n.slice(n.lastIndexOf(",")+1,n.length-1)*280;e.elemPicker.find("."+j).css("left",a)}e.elemPicker.find("."+H)[0].style.background="linear-gradient(to right, rgba("+l.r+", "+l.g+", "+l.b+", 0), rgb("+l.r+", "+l.g+", "+l.b+"))"}}else{e.select(0,100,100);r.find("input").val("");e.elemPicker.find("."+H)[0].style.background="";e.elemPicker.find("."+j).css("left",280)}};l.prototype.side=function(){var s=this,c=s.config,l=s.elemColorBox.find("."+C),a=l.attr("lay-type"),f=s.elemPicker.find("."+w),e=s.elemPicker.find("."+D),u=s.elemPicker.find("."+E),n=s.elemPicker.find("."+W),d=s.elemPicker.find("."+H),p=s.elemPicker.find("."+j),v=e[0].offsetTop/180*360,g=100-(n[0].offsetTop+3)/180*100,h=(n[0].offsetLeft+3)/260*100,b=Math.round(p[0].offsetLeft/280*100)/100,m=s.elemColorBox.find("."+B),i=s.elemPicker.find(".soxui-colorpicker-pre").children("div"),k=function(e,i,o,r){s.select(e,i,o);var t=M({h:e,s:i,b:o});m.addClass(y).removeClass(P);l[0].style.background="rgb("+t.r+", "+t.g+", "+t.b+")";if(a==="torgb"){s.elemPicker.find("."+F).find("input").val("rgb("+t.r+", "+t.g+", "+t.b+")")}if(a==="rgba"){var n=0;n=r*280;p.css("left",n);s.elemPicker.find("."+F).find("input").val("rgba("+t.r+", "+t.g+", "+t.b+", "+r+")");l[0].style.background="rgba("+t.r+", "+t.g+", "+t.b+", "+r+")";d[0].style.background="linear-gradient(to right, rgba("+t.r+", "+t.g+", "+t.b+", 0), rgb("+t.r+", "+t.g+", "+t.b+"))"}c.change&&c.change(s.elemPicker.find("."+F).find("input").val())},o=x(['<div class="soxui-auxiliar-moving" id="LAY-colorpicker-moving"></div'].join("")),r=function(e){x("#LAY-colorpicker-moving")[0]||x("body").append(o);o.on("mousemove",e);o.on("mouseup",function(){o.remove()}).on("mouseleave",function(){o.remove()})};e.on("mousedown",function(e){var t=this.offsetTop,n=e.clientY;var i=function(e){var i=t+(e.clientY-n),o=f[0].offsetHeight;if(i<0)i=0;if(i>o)i=o;var r=i/180*360;v=r;k(r,h,g,b);e.preventDefault()};r(i);e.preventDefault()});f.on("click",function(e){var i=e.clientY-x(this).offset().top;if(i<0)i=0;if(i>this.offsetHeight)i=this.offsetHeight;var o=i/180*360;v=o;k(o,h,g,b);e.preventDefault()});n.on("mousedown",function(i){var c=this.offsetTop,l=this.offsetLeft,a=i.clientY,f=i.clientX;var e=function(e){var i=c+(e.clientY-a),o=l+(e.clientX-f),r=u[0].offsetHeight-3,t=u[0].offsetWidth-3;if(i<-3)i=-3;if(i>r)i=r;if(o<-3)o=-3;if(o>t)o=t;var n=(o+3)/260*100,s=100-(i+3)/180*100;g=s;h=n;k(v,n,s,b);e.preventDefault()};try{i.stopPropagation()}catch(e){i.cancelBubble=true}r(e);i.preventDefault()});u.on("mousedown",function(e){var i=e.clientY-x(this).offset().top-3+I.scrollTop(),o=e.clientX-x(this).offset().left-3+I.scrollLeft();if(i<-3)i=-3;if(i>this.offsetHeight-3)i=this.offsetHeight-3;if(o<-3)o=-3;if(o>this.offsetWidth-3)o=this.offsetWidth-3;var r=(o+3)/260*100,t=100-(i+3)/180*100;g=t;h=r;k(v,r,t,b);e.preventDefault();n.trigger(e,"mousedown")});p.on("mousedown",function(e){var t=this.offsetLeft,n=e.clientX;var i=function(e){var i=t+(e.clientX-n),o=d[0].offsetWidth;if(i<0)i=0;if(i>o)i=o;var r=Math.round(i/280*100)/100;b=r;k(v,h,g,r);e.preventDefault()};r(i);e.preventDefault()});d.on("click",function(e){var i=e.clientX-x(this).offset().left;if(i<0)i=0;if(i>this.offsetWidth)i=this.offsetWidth;var o=Math.round(i/280*100)/100;b=o;k(v,h,g,o);e.preventDefault()});i.each(function(){x(this).on("click",function(){x(this).parent(".soxui-colorpicker-pre").addClass("selected").siblings().removeClass("selected");var e=this.style.backgroundColor,i=L(Y(e)),o=e.slice(e.lastIndexOf(",")+1,e.length-1),r;v=i.h;h=i.s;g=i.b;if((e.match(/[0-9]{1,3}/g)||[]).length==3)o=1;b=o;r=o*280;k(i.h,i.s,i.b,o)})})};l.prototype.select=function(e,i,o,r){var t=this,n=t.config,s=u({h:e,s:100,b:100}),c=u({h:e,s:i,b:o}),l=e/360*180,a=180-o/100*180-3,f=i/100*260-3;t.elemPicker.find("."+D).css("top",l);t.elemPicker.find("."+E)[0].style.background="#"+s;t.elemPicker.find("."+W).css({top:a,left:f});if(r==="change")return;t.elemPicker.find("."+F).find("input").val("#"+c)};l.prototype.pickerEvents=function(){var s=this,c=s.config,l=s.elemColorBox.find("."+C),a=s.elemPicker.find("."+F+" input"),o={clear:function(e){l[0].style.background="";s.elemColorBox.find("."+B).removeClass(y).addClass(P);s.color="";c.done&&c.done("");s.removePicker()},confirm:function(e,i){var o=a.val(),r=o,t={};if(o.indexOf(",")>-1){t=L(Y(o));s.select(t.h,t.s,t.b);l[0].style.background=r="#"+u(t);if((o.match(/[0-9]{1,3}/g)||[]).length>3&&l.attr("lay-type")==="rgba"){var n=o.slice(o.lastIndexOf(",")+1,o.length-1)*280;s.elemPicker.find("."+j).css("left",n);l[0].style.background=o;r=o}}else{t=f(o);l[0].style.background=r="#"+u(t);s.elemColorBox.find("."+B).removeClass(P).addClass(y)}if(i==="change"){s.select(t.h,t.s,t.b,i);c.change&&c.change(r);return}s.color=o;c.done&&c.done(o);s.removePicker()}};s.elemPicker.on("click","*[colorpicker-events]",function(){var e=x(this),i=e.attr("colorpicker-events");o[i]&&o[i].call(this,e)});a.on("keyup",function(e){var i=x(this);o.confirm.call(this,i,e.keyCode===13?null:"change")})};l.prototype.events=function(){var o=this,e=o.config,r=o.elemColorBox.find("."+C);o.elemColorBox.on("click",function(){o.renderPicker();if(x(s)[0]){o.val();o.side()}});if(!e.elem[0]||o.elemColorBox[0].eventHandler)return;c.on("click",function(e){if(x(e.target).hasClass(t)||x(e.target).parents("."+t)[0])return;if(x(e.target).hasClass(s.replace(/\./g,""))||x(e.target).parents(s)[0])return;if(!o.elemPicker)return;if(o.color){var i=L(Y(o.color));o.select(i.h,i.s,i.b)}else{o.elemColorBox.find("."+B).removeClass(y).addClass(P)}r[0].style.background=o.color||"";o.removePicker()});I.on("resize",function(){if(!o.elemPicker||!x(s)[0]){return false}o.position()});o.elemColorBox[0].eventHandler=true};o.render=function(e){var i=new l(e);return r.call(i)};this.render=o.render;return this}if(typeof soxui!="undefined"){soxui.colorpicker=new e}else{window.soxcolorpicker=new e}})();