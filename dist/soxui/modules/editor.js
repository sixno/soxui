(function(){"use strict";function L(){this.version="1.0.0";this.modules=["tpl","pop"];if(typeof soxui!="undefined"&&soxui.$){var u=soxui.$}else{if(typeof jQuery=="undefined"){typeof console=="object"&&console.error("soxpop error: sorry, jQuery is required, you must load it before this script.");return false}if(typeof soxui=="undefined")window["soxui"]={};for(var e in this.modules){if(typeof window["sox"+this.modules[e]]=="undefined"){typeof console=="object"&&console.error("soxpop error: sorry, sox"+this.modules[e]+" is required, you must load it before this script.");return false}window["soxui"][this.modules[e]]=window["sox"+this.modules[e]]}}var t="";var s="";var o="";var a={};var n=this.version;t=document.currentScript?document.currentScript.src:function(){for(var e=document.scripts.length-1;e>0;e--){if(document.scripts[e].readyState==="interactive")return document.scripts[e].src}return document.scripts[0].src}();s=t.substring(0,t.lastIndexOf("/")-7)+"images/face/";o=t.substring(0,t.lastIndexOf("/")-7)+"templates/editor/";var l=function(t,i){u.ajax({async:true,type:"GET",url:o+t+".html?v="+n+"."+(new Date).getTime(),success:function(e){a[t]=soxui.tpl.create(e);if(typeof i=="function")i()},error:function(){typeof console=="object"&&console.error("soxeditor error: can`t find the template.")},dataType:"html"})};var f={ie:function(){var e=navigator.userAgent.toLowerCase();return!!window.ActiveXObject||"ActiveXObject"in window?(e.match(/msie\s(\d+)/)||[])[1]||"11":false}()},i="editor",r="soxui-this",p="soxui-show",x="soxui-disabled";this.index=0;this.config={tool:["strong","italic","underline","del","|","left","center","right","|","link","unlink","face","image"],hideTool:[],height:280};this.set=function(e){var t=this;u.extend(true,t.config,e);return t};this.build=function(e,t){t=t||{};var i=this,o=i.config,n="soxui-editor",r=u(typeof e=="string"?"#"+e:e),s="LAY_editor_"+ ++i.index,a=r.next("."+n),l=u.extend({},o,t),c=function(){var i=[],o={};u.each(l.hideTool,function(e,t){o[t]=true});u.each(l.tool,function(e,t){if(j[t]&&!o[t]){i.push(j[t])}});return i.join("")}(),d=u(['<div class="'+n+'">','<div class="soxui-unselect soxui-editor-tool">'+c+"</div>",'<div class="soxui-editor-iframe">','<iframe id="'+s+'" name="'+s+'" textarea="'+e+'" frameborder="0"></iframe>',"</div>","</div>"].join(""));if(f.ie&&f.ie<8){return r.removeClass("soxui-hide").addClass(p)}a[0]&&a.remove();m.call(i,d,r[0],l);r.addClass("soxui-hide").after(d);return i.index};this.getContent=function(e){var t=c(e);if(!t[0])return;return d(t[0].document.body.innerHTML)};this.getText=function(e){var t=c(e);if(!t[0])return;return u(t[0].document.body).text()};this.setContent=function(e,t,i){var o=c(e);if(!o[0])return;if(i){u(o[0].document.body).append(t)}else{u(o[0].document.body).html(t)}L.sync(e)};this.sync=function(e){var t=c(e);if(!t[0])return;var i=u("#"+t[1].attr("textarea"));i.val(d(t[0].document.body.innerHTML))};this.getSelection=function(e){var t=c(e);if(!t[0])return;var i=g(t[0].document);return document.selection?i.text:i.toString()};var m=function(r,s,a){var l=this,c=r.find("iframe");c.css({height:a.height}).on("load",function(){var e=c.contents(),t=c.prop("contentWindow"),i=e.find("head"),o=u(["<style>","*{margin: 0; padding: 0;}","body{padding: 10px; line-height: 20px; overflow-x: hidden; word-wrap: break-word; font: 14px Helvetica Neue,Helvetica,PingFang SC,Microsoft YaHei,Tahoma,Arial,sans-serif; -webkit-box-sizing: border-box !important; -moz-box-sizing: border-box !important; box-sizing: border-box !important;}","a{color:#01AAED; text-decoration:none;}a:hover{color:#c00}","p{margin-bottom: 10px;}","img{display: inline-block; border: none; vertical-align: middle;}","pre{margin: 10px 0; padding: 10px; line-height: 20px; border: 1px solid #ddd; border-left-width: 6px; background-color: #F2F2F2; color: #333; font-family: Courier New; font-size: 12px;}","</style>"].join("")),n=e.find("body");i.append(o);n.attr("contenteditable","true").css({"min-height":a.height}).html(s.value||"");h.apply(l,[t,c,s,a]);C.call(l,t,r,a)})},c=function(e){var t=u("#LAY_editor_"+e),i=t.prop("contentWindow");return[i,t]},d=function(e){if(f.ie==8){e=e.replace(/<.+>/g,function(e){return e.toLowerCase()})}return e},h=function(t,e,i,o){var r=t.document,n=u(r.body);n.on("keydown",function(e){var t=e.keyCode;if(t===13){var i=g(r);var o=y(i),n=o.parentNode;if(n.tagName.toLowerCase()==="pre"){if(e.shiftKey)return;soxui.pop.msg("请暂时用shift+enter");return false}r.execCommand("formatBlock",false,"<p>")}});u(i).parents("form").on("submit",function(){var e=n.html();if(f.ie==8){e=e.replace(/<.+>/g,function(e){return e.toLowerCase()})}i.value=e});n.on("paste",function(e){r.execCommand("formatBlock",false,"<p>");setTimeout(function(){v.call(t,n);i.value=n.html()},100)})},v=function(e){var t=this,i=t.document;e.find("*[style]").each(function(){var e=this.style.textAlign;this.removeAttribute("style");u(this).css({"text-align":e||""})});e.find("table").addClass("soxui-table");e.find("script,link").remove()},g=function(e){return e.selection?e.selection.createRange():e.getSelection().getRangeAt(0)},y=function(e){return e.endContainer||e.parentElement().childNodes[0]},b=function(e,t,i){var o=this.document,n=document.createElement(e);for(var r in t){n.setAttribute(r,t[r])}n.removeAttribute("text");if(o.selection){var s=i.text||t.text;if(e==="a"&&!s)return;if(s){n.innerHTML=s}i.pasteHTML(u(n).prop("outerHTML"));i.select()}else{var s=i.toString()||t.text;if(e==="a"&&!s)return;if(s){n.innerHTML=s}i.deleteContents();i.insertNode(n)}},k=function(t,e){var i=this.document,o="editor-tool-active",n=y(g(i)),r=function(e){return t.find(".editor-tool-"+e)};if(e){e[e.hasClass(o)?"removeClass":"addClass"](o)}t.find(">i").removeClass(o);r("unlink").addClass(x);u(n).parents().each(function(){var e=this.tagName.toLowerCase(),t=this.style.textAlign;if(e==="b"||e==="strong"){r("b").addClass(o)}if(e==="i"||e==="em"){r("i").addClass(o)}if(e==="u"){r("u").addClass(o)}if(e==="strike"){r("d").addClass(o)}if(e==="p"){if(t==="center"){r("center").addClass(o)}else if(t==="right"){r("right").addClass(o)}else{r("left").addClass(o)}}if(e==="a"){r("link").addClass(o);r("unlink").removeClass(x)}})},C=function(s,e,a){var r=s.document,l=u(r.body),c={link:function(i){var e=y(i),o=u(e).parent();w.call(l,{text:document.selection?i.text:i.toString(),href:o.attr("href")||"",target:o.attr("target")||""},function(e){var t=o[0];if(t.tagName==="A"){t.href=e.href}else{if(e.text==="")e.text=e.href;b.call(s,"a",e,i)}})},unlink:function(e){r.execCommand("unlink")},face:function(t){_.call(this,function(e){b.call(s,"img",{src:e.src,alt:e.alt},t)})},image:function(r){var e=u(u(this).find("input")[0]);e.unbind("change");e.change(function(e){if(!a.uploadImage){this.value="";soxui.pop.msg("未设置上传参数");return}if(this.files.length>0){var i=a.uploadImage;var t={".jpg":1,".jpeg":1,".png":1,".gif":1,".bmp":1};var o=this.value.substr(this.value.lastIndexOf(".")).toLowerCase();if(!t[o]){soxui.pop.msg("非图片文件");return}if(i.size&&this.files[0].size>i.size*1024){soxui.pop.msg("文件大小超过"+i.size+"KB");return}var n=new FormData;n.append(i.file||"file",this.files[0]);this.value="";u.ajax({url:i.url,type:"POST",crossDomain:true,xhrFields:{withCredentials:true},data:n,cache:false,contentType:false,processData:false,success:function(e){var t=i.data(e);if(t){b.call(s,"img",t,r)}else{soxui.pop.msg("图片上传失败")}},error:function(){soxui.pop.msg("图片上传失败")},dataType:"json"})}else{soxui.pop.msg("未选中文件");this.value=""}})},code:function(t){T.call(l,function(e){b.call(s,"pre",{text:e.code,"lay-lang":e.lang},t)})},help:function(){soxui.pop.open({type:2,title:"帮助",area:["600px","380px"],shadeClose:true,shade:.1,skin:"soxui-layer-msg",content:"http://www.soxui.com/#bW9kdWxlL2VkaXRvcnx8"})}},d=e.find(".soxui-editor-tool"),i=function(){var e=u(this),t=e.attr("editor-event"),i=e.attr("lay-command");if(e.hasClass(x))return;l.focus();var o=g(r),n=o.commonAncestorContainer;if(i){r.execCommand(i);if(/justifyLeft|justifyCenter|justifyRight/.test(i)){r.execCommand("formatBlock",false,"<p>")}setTimeout(function(){l.focus()},10)}else{c[t]&&c[t].call(this,o)}k.call(s,d,e)},o=/image/;d.find(">i").on("mousedown",function(){var e=u(this),t=e.attr("editor-event");if(o.test(t))return;i.call(this)}).on("click",function(){var e=u(this),t=e.attr("editor-event");if(!o.test(t))return;i.call(this)});l.on("click",function(){k.call(s,d);soxui.pop.close(_.index)})},w=function(e,r){var t=this;var i={type:1,id:"LAY_editor_link",area:"350px",shade:.05,shadeClose:true,moveType:1,title:"超链接",skin:"soxui-layer-msg",content:"",success:function(e,n){e.find(".btn").on("click",function(){var e=u(this);if(e.attr("sox-filter")=="editor-ok"){var t=u("#"+e.attr("sox-editor")).serializeArray();var i={};for(var o in t){i[t[o].name]=t[o].value}r&&r(i)}soxui.pop.close(n)})}};if(a["editor_tool_link"]){i.content=soxui.tpl.render(a["editor_tool_link"],e);w.index=soxui.pop.open(i)}else{l("editor_tool_link",function(){i.content=soxui.tpl.render(a["editor_tool_link"],e);w.index=soxui.pop.open(i)})}},_=function(i){var e=this;var t=s;var o=["[微笑]","[嘻嘻]","[哈哈]","[可爱]","[可怜]","[挖鼻]","[吃惊]","[害羞]","[挤眼]","[闭嘴]","[鄙视]","[爱你]","[泪]","[偷笑]","[亲亲]","[生病]","[太开心]","[白眼]","[右哼哼]","[左哼哼]","[嘘]","[衰]","[委屈]","[吐]","[哈欠]","[抱抱]","[怒]","[疑问]","[馋嘴]","[拜拜]","[思考]","[汗]","[困]","[睡]","[钱]","[失望]","[酷]","[色]","[哼]","[鼓掌]","[晕]","[悲伤]","[抓狂]","[黑线]","[阴险]","[怒骂]","[互粉]","[心]","[伤心]","[猪头]","[熊猫]","[兔子]","[ok]","[耶]","[good]","[NO]","[赞]","[来]","[弱]","[草泥马]","[神马]","[囧]","[浮云]","[给力]","[围观]","[威武]","[奥特曼]","[礼物]","[钟]","[话筒]","[蜡烛]","[蛋糕]"];var n="";var r={tips:1,time:0,skin:"soxui-box soxui-util-face",nomc:true,maxWidth:500,success:function(e,t){e.css({marginTop:-4,marginLeft:-10}).find(".soxui-clear>li").on("click",function(){var e=u(this).find("img");i&&i({src:e.attr("src"),alt:e.attr("alt")});soxui.pop.close(t)});u(document).off("click",_.hide).on("click",_.hide)}};_.hide=_.hide||function(e){if(_.index>0&&u(e.target).attr("editor-event")!=="face"){soxui.pop.close(_.index);_.index=0}};if(a["editor_tool_face"]){n=soxui.tpl.render(a["editor_tool_face"],{path:t,alts:o});_.index=soxui.pop.tips(n,e,r)}else{l("editor_tool_face",function(){r.content=soxui.tpl.render(a["editor_tool_face"],{path:t,alts:o});_.index=soxui.pop.tips(n,e,r)})}},T=function(r){var e=this;var t={type:1,id:"LAY_editor_code",area:"550px",shade:.05,shadeClose:true,moveType:1,title:"插入代码",skin:"soxui-layer-msg",content:"",success:function(e,n){e.find(".btn").on("click",function(){var e=u(this);if(e.attr("sox-filter")=="editor-ok"){var t=u("#"+e.attr("sox-editor")).serializeArray();var i={};for(var o in t){i[t[o].name]=t[o].value}r&&r(i)}soxui.pop.close(n)})}};if(a["editor_tool_code"]){t.content=soxui.tpl.render(a["editor_tool_code"]);T.index=soxui.pop.open(t)}else{l("editor_tool_code",function(){t.content=soxui.tpl.render(a["editor_tool_code"]);T.index=soxui.pop.open(t)})}},j={html:'<i class="soxui-icon editor-tool-html" title="HTML源代码" lay-command="html" editor-event="html"">&#xe64b;</i>',strong:'<i class="soxui-icon editor-tool-b" title="加粗" lay-command="Bold" editor-event="b"">&#xe62b;</i>',italic:'<i class="soxui-icon editor-tool-i" title="斜体" lay-command="italic" editor-event="i"">&#xe644;</i>',underline:'<i class="soxui-icon editor-tool-u" title="下划线" lay-command="underline" editor-event="u"">&#xe646;</i>',del:'<i class="soxui-icon editor-tool-d" title="删除线" lay-command="strikeThrough" editor-event="d"">&#xe64f;</i>',"|":'<span class="editor-tool-mid"></span>',left:'<i class="soxui-icon editor-tool-left" title="左对齐" lay-command="justifyLeft" editor-event="left"">&#xe649;</i>',center:'<i class="soxui-icon editor-tool-center" title="居中对齐" lay-command="justifyCenter" editor-event="center"">&#xe647;</i>',right:'<i class="soxui-icon editor-tool-right" title="右对齐" lay-command="justifyRight" editor-event="right"">&#xe648;</i>',link:'<i class="soxui-icon editor-tool-link" title="插入链接" editor-event="link"">&#xe64c;</i>',unlink:'<i class="soxui-icon editor-tool-unlink soxui-disabled" title="清除链接" lay-command="unlink" editor-event="unlink"">&#xe64d;</i>',face:'<i class="soxui-icon editor-tool-face" title="表情" editor-event="face"">&#xe650;</i>',image:'<i class="soxui-icon editor-tool-image" title="图片" editor-event="image">&#xe64a;<input type="file" name="file"></i>',code:'<i class="soxui-icon editor-tool-code" title="插入代码" editor-event="code">&#xe64e;</i>',help:'<i class="soxui-icon editor-tool-help" title="帮助" editor-event="help">&#xe607;</i>'}}if(typeof soxui!="undefined"){soxui.editor=new L}else{window.soxeditor=new L}})();